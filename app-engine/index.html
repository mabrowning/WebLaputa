<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="utf-8">
<script type="text/javascript" src="js/glMatrix-0.9.5.min.js"></script>
<script type="text/javascript" src="js/wlbase.js"></script>
<script type="text/javascript" src="js/wlchunk.js"></script>
<script type="text/javascript" src="js/wlworld.js"></script>
<script type="text/javascript" src="js/wlrenderer.js"></script>

<script id="shader-fs" type="x-shader/x-fragment">
    precision mediump float;

    varying vec2 vTextureCoord;
    varying vec3 vTransformedNormal;
    varying vec4 vPosition;

    uniform sampler2D uSampler;

    uniform float uMaterialShininess;

    uniform bool uShowSpecularHighlights;
    uniform bool uUseTextures;

    uniform vec3 uLightAmCol; 
    uniform vec3 uLightPos;
    uniform vec3 uLightSpCol;
    uniform vec3 uLightDiCol;


    void main(void) {
        vec3 lightWeighting;
		vec3 lightDirection = normalize(uLightPos - vPosition.xyz);
		vec3 normal = normalize(vTransformedNormal);

		/*
		float specularLightWeighting = 0.0;
		if (uShowSpecularHighlights) {
			vec3 eyeDirection = normalize(-vPosition.xyz);
			vec3 reflectionDirection = reflect(-lightDirection, normal);

			specularLightWeighting = pow(max(dot(reflectionDirection, eyeDirection), 0.0), uMaterialShininess);
		}
		*/

		float diffuseLightWeighting = max(dot(normal, lightDirection), 0.0);
		lightWeighting = uLightAmCol
//			+ uLightSpCol * specularLightWeighting
			+ uLightDiCol * diffuseLightWeighting;

        vec4 fragmentColor;
        if (uUseTextures) {
            fragmentColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
        } else {
            fragmentColor = vec4(0.1, 0.6, 0.1, 1.0);
        }
        gl_FragColor = vec4(fragmentColor.rgb * lightWeighting, fragmentColor.a);
    }
</script>

<script id="shader-vs" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;
    attribute vec3 aVertexNormal;
    attribute vec2 aTextureCoord;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;
//    uniform mat3 uNMatrix;


    varying vec2 vTextureCoord;
    varying vec3 vTransformedNormal;
    varying vec4 vPosition;


    void main(void) {
        vPosition = uMVMatrix * vec4(aVertexPosition, 1.0);
        gl_Position = uPMatrix * vPosition;
		gl_PointSize = 2.0;
        vTextureCoord = aTextureCoord;
//        vTransformedNormal = uNMatrix * aVertexNormal;
        vTransformedNormal = aVertexNormal;
    }
</script>
	</head>
	<body onload="start();">
		<canvas id="webGL" style="border: none;" width="1000" height="1000" >
	</body>
</html>

